{"Id":26,"Title":"PHP安装taint扩展（linux平台下）","Slug":"php-taint","Text":"先到相关站点下载扩展包文件http://www.php.net/manual/zh/taint.configuration.php\n\n解压后，将taint-1.2.1放到php编译安装的源目录下的ext目录下。\n\n例如我的php编译安装时的源在/home/xiao/soft/php-5.4.10，\n\n就将解压的taint-1.2.1放在/home/xiao/soft/php-5.4.10/ext目录下。\n\n然后编译执行过程记录如下：\n\n    xiao-M68MT-S2P taint-1.2.1 # cd /home/xiao/soft/php-5.4.10/ext/taint-1.2.1\n    xiao-M68MT-S2P taint-1.2.1 # phpize\n    Configuring for:\n    PHP Api Version:         20090626\n    Zend Module Api No:      20090626\n    Zend Extension Api No:   220090626\n    xiao-M68MT-S2P taint-1.2.1 # ./configure --with-php-config=/opt/php/bin/php-config\n    checking for grep that handles long lines and -e... /bin/grep\n    checking for egrep... /bin/grep -E\n    checking for a sed that does not truncate output... /bin/sed\n    checking for cc... cc\n    checking whether the C compiler works... yes\n    checking for C compiler default output file name... a.out\n    checking for suffix of executables... \n    checking whether we are cross compiling... no\n    checking for suffix of object files... o\n    checking whether we are using the GNU C compiler... yes\n    checking whether cc accepts -g... yes\n    checking for cc option to accept ISO C89... none needed\n    checking how to run the C preprocessor... cc -E\n    checking for icc... no\n    checking for suncc... no\n    checking whether cc understands -c and -o together... yes\n    checking for system library directory... lib\n    checking if compiler supports -R... no\n    checking if compiler supports -Wl,-rpath,... yes\n    checking build system type... x86_64-unknown-linux-gnu\n    checking host system type... x86_64-unknown-linux-gnu\n    checking target system type... x86_64-unknown-linux-gnu\n    checking for PHP prefix... /opt/php\n    checking for PHP includes... -I/opt/php/include/php -I/opt/php/include/php/main -I/opt/php/include/php/TSRM -I/opt/php/include/php/Zend -I/opt/php/include/php/ext -I/opt/php/include/php/ext/date/lib\n    checking for PHP extension directory... /opt/php/lib/php/extensions/no-debug-non-zts-20100525\n    checking for PHP installed headers prefix... /opt/php/include/php\n    checking if debug is enabled... no\n    checking if zts is enabled... no\n    checking for re2c... no\n    configure: WARNING: You will need re2c 0.13.4 or later if you want to regenerate PHP parsers.\n    checking for gawk... gawk\n    checking whether to enable taint support... yes, shared\n    checking how to print strings... printf\n    checking for a sed that does not truncate output... (cached) /bin/sed\n    checking for fgrep... /bin/grep -F\n    checking for ld used by cc... /usr/bin/ld\n    checking if the linker (/usr/bin/ld) is GNU ld... yes\n    checking for BSD- or MS-compatible name lister (nm)... /usr/bin/nm -B\n    checking the name lister (/usr/bin/nm -B) interface... BSD nm\n    checking whether ln -s works... yes\n    checking the maximum length of command line arguments... 1572864\n    checking whether the shell understands some XSI constructs... yes\n    checking whether the shell understands \"+=\"... yes\n    checking how to convert x86_64-unknown-linux-gnu file names to x86_64-unknown-linux-gnu format... func_convert_file_noop\n    checking how to convert x86_64-unknown-linux-gnu file names to toolchain format... func_convert_file_noop\n    checking for /usr/bin/ld option to reload object files... -r\n    checking for objdump... objdump\n    checking how to recognize dependent libraries... pass_all\n    checking for dlltool... no\n    checking how to associate runtime and link libraries... printf %s\\n\n    checking for ar... ar\n    checking for archiver @FILE support... @\n    checking for strip... strip\n    checking for ranlib... ranlib\n    checking for gawk... (cached) gawk\n    checking command to parse /usr/bin/nm -B output from cc object... ok\n    checking for sysroot... no\n    checking for mt... mt\n    checking if mt is a manifest tool... no\n    checking for ANSI C header files... yes\n    checking for sys/types.h... yes\n    checking for sys/stat.h... yes\n    checking for stdlib.h... yes\n    checking for string.h... yes\n    checking for memory.h... yes\n    checking for strings.h... yes\n    checking for inttypes.h... yes\n    checking for stdint.h... yes\n    checking for unistd.h... yes\n    checking for dlfcn.h... yes\n    checking for objdir... .libs\n    checking if cc supports -fno-rtti -fno-exceptions... no\n    checking for cc option to produce PIC... -fPIC -DPIC\n    checking if cc PIC flag -fPIC -DPIC works... yes\n    checking if cc static flag -static works... yes\n    checking if cc supports -c -o file.o... yes\n    checking if cc supports -c -o file.o... (cached) yes\n    checking whether the cc linker (/usr/bin/ld -m elf_x86_64) supports shared libraries... yes\n    checking whether -lc should be explicitly linked in... no\n    checking dynamic linker characteristics... GNU/Linux ld.so\n    checking how to hardcode library paths into programs... immediate\n    checking whether stripping libraries is possible... yes\n    checking if libtool supports shared libraries... yes\n    checking whether to build shared libraries... yes\n    checking whether to build static libraries... no\n    configure: creating ./config.status\n    config.status: creating config.h\n    config.status: executing libtool commands\n    xiao-M68MT-S2P taint-1.2.1 # make\n    /bin/bash /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/libtool --mode=compile cc  -I. -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1 -DPHP_ATOM_INC -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1/include -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1/main -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1 -I/opt/php/include/php -I/opt/php/include/php/main -I/opt/php/include/php/TSRM -I/opt/php/include/php/Zend -I/opt/php/include/php/ext -I/opt/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -c /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/taint.c -o taint.lo \n    libtool: compile:  cc -I. -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1 -DPHP_ATOM_INC -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1/include -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1/main -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1 -I/opt/php/include/php -I/opt/php/include/php/main -I/opt/php/include/php/TSRM -I/opt/php/include/php/Zend -I/opt/php/include/php/ext -I/opt/php/include/php/ext/date/lib -DHAVE_CONFIG_H -g -O2 -c /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/taint.c  -fPIC -DPIC -o .libs/taint.o\n    /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/taint.c: In function 'zif_taint_strval':\n    /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/taint.c:2244:2: warning: 'zend_get_parameters_ex' is deprecated (declared at /opt/php/include/php/Zend/zend_API.h:238) [-Wdeprecated-declarations]\n    /bin/bash /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/libtool --mode=link cc -DPHP_ATOM_INC -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1/include -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1/main -I/home/xiao/soft/php-5.4.10/ext/taint-1.2.1 -I/opt/php/include/php -I/opt/php/include/php/main -I/opt/php/include/php/TSRM -I/opt/php/include/php/Zend -I/opt/php/include/php/ext -I/opt/php/include/php/ext/date/lib  -DHAVE_CONFIG_H  -g -O2   -o taint.la -export-dynamic -avoid-version -prefer-pic -module -rpath /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/modules  taint.lo \n    libtool: link: cc -shared  -fPIC -DPIC  .libs/taint.o    -O2   -Wl,-soname -Wl,taint.so -o .libs/taint.so\n    libtool: link: ( cd \".libs\" \u0026\u0026 rm -f \"taint.la\" \u0026\u0026 ln -s \"../taint.la\" \"taint.la\" )\n    /bin/bash /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/libtool --mode=install cp ./taint.la /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/modules\n    libtool: install: cp ./.libs/taint.so /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/modules/taint.so\n    libtool: install: cp ./.libs/taint.lai /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/modules/taint.la\n    libtool: finish: PATH=\"/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/sbin\" ldconfig -n /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/modules\n    ----------------------------------------------------------------------\n    Libraries have been installed in:\n       /home/xiao/soft/php-5.4.10/ext/taint-1.2.1/modules\n    \n    If you ever happen to want to link against installed libraries\n    in a given directory, LIBDIR, you must either use libtool, and\n    specify the full pathname of the library, or use the `-LLIBDIR'\n    flag during linking and do at least one of the following:\n       - add LIBDIR to the `LD_LIBRARY_PATH' environment variable\n         during execution\n       - add LIBDIR to the `LD_RUN_PATH' environment variable\n         during linking\n       - use the `-Wl,-rpath -Wl,LIBDIR' linker flag\n       - have your system administrator add LIBDIR to `/etc/ld.so.conf'\n    \n    See any operating system documentation about shared libraries for\n    more information, such as the ld(1) and ld.so(8) manual pages.\n    ----------------------------------------------------------------------\n    \n    Build complete.\n    Don't forget to run 'make test'.\n    \n    xiao-M68MT-S2P taint-1.2.1 # make install\n    Installing shared extensions:     /opt/php/lib/php/extensions/no-debug-non-zts-20100525/\n\n到此，说明扩展已安装成功了。\n\n编辑php.ini文件，增加如下配置参数：\n\n\u0009xiao-M68MT-S2P / # vim /etc/php.ini \n\n新增如下代码\n\n    extension=taint.so\n    taint.enable=1\n    taint.error_level=E_WARNING\n\n最后重启php：\n\n\u0009xiao-M68MT-S2P taint-1.2.1 # php-frm restart\n\nOK，大功告成了! 可以测试php脚本了！","Tags":["php"],"CreateTime":1415975801,"EditTime":1415975801,"UpdateTime":1415975801,"IsComment":true,"IsLinked":false,"AuthorId":5,"Template":"blog.html","Type":"article","Status":"publish","Format":"markdown","Comments":[],"Hits":4}